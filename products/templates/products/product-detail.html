{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="container">

    <!-- Product -->
    <h2 class="text-center">{{ product.name }}</h2>
    {% if request.user.is_superuser %}
    <div class="row">
        <div class="col-auto mx-auto">
            <small class="text-center">
                <a href="{% url 'edit_product' product.id %}">Edit</a> | 
                <a class="text-danger" href="{% url 'delete_product' product.id %}">Delete</a>
            </small>
        </div>
    </div>
    {% endif %}

    {% if product.reviews.all %}
        <p class="text-center">{{ product.average_rating | floatformat:2 }}</p>
        <p class="text-center"><a href="#product-reviews">{{ product.reviews.all | length }} review{{ product.reviews.all | length | pluralize }}</a></p>
    {% else %}
        <p class="text-center">No reviews</p>
        <p class="text-center"><a href="#product-reviews">Leave your own?</a></p>
    {% endif %}
    <ul class="list-inline text-center">
        {% for tag in product.tags.all %}
        <li class="list-inline-item"><a href="{% url 'products' %}?q={{tag.name}}">{{ tag.name | capfirst }}</a></li>
        {% endfor %}
    </ul>
    <p class="text-center">{{ product.description }}</p>

    <hr>

    <form class="form my-3 text-center" action="{% url 'add_to_cart' product.id %}" method="POST">
        {% csrf_token %}
        <div class="form-row">
            <!-- Size -->
            <div class="col-12 btn-group-toggle my-3" data-toggle="buttons">
                <h5 class="my-3 text-center">Size</h5>
                {% for size in product.brand.available_sizes.all %}
                    <label class="btn btn-outline-dark active m-1">
                        <input type="radio" name="size" value="{{ size.id }}" autocomplete="off" required> {{ size.label }}
                    </label>
                {% endfor %}
            </div>

            <!-- Nic content -->
            <div class="col-12 btn-group-toggle my-3" data-toggle="buttons">
                <h5 class="my-3 text-center">Nic content</h5>
                {% for nic in product.brand.available_nics.all %}
                    <label class="btn btn-outline-dark active m-1">
                        <input type="radio" name="nic" value="{{ nic.id }}" autocomplete="off" required> {{ nic.strength }} {{ nic.type }}
                    </label>
                {% endfor %}
            </div>

            <!-- Quantity -->
            <div class="col-auto mx-auto">
                <h5 class="my-3 text-center" >Quantity</h5>
                <div class="form-group d-flex justify-content-center">
                    <div class="input-group"> 

                        <!-- Decrement qty -->
                        <div class="input-group-prepend">
                            <button class="decrement-qty btn btn-black rounded-0" 
                                data-item_id="{{ product.id }}" id="decrement-qty_{{ product.id }}">
                                <span class="icon">
                                    <i class="fas fa-caret-left"></i>
                                </span>
                            </button>
                        </div>

                        <!-- Input qty -->
                        <input class="form-control qty_input text-center" type="number" name="quantity" value="1" min="1" max="99" data-item_id="{{ product.id }}" id="id_qty_{{ product.id }}" autocomplete="off">

                        <!-- Increment qty -->
                        <div class="input-group-append">
                            <button class="increment-qty btn btn-black rounded-0"
                            data-item_id="{{ product.id }}" id="increment-qty_{{ product.id }}">
                                <span class="icon">
                                    <i class="fas fa-caret-right"></i>
                                </span>
                            </button>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Add to cart / back -->
            <div class="col-12">
                <a href="{% url 'products' %}" class="btn btn-outline-dark mt-5">
                    <span class="icon">
                        <i class="fas fa-chevron-left"></i>
                    </span>
                    Back to Juices
                </a>
                <input type="submit" class="btn btn-outline-dark mt-5" value="Add to Cart">
            </div>
            <input type="hidden" name="redirect_url" value="{{ request.path }}">
        </div>
    </form>
    <hr>

    <!-- Reviews -->
    <h2 class="text-center">Reviews</h2>
    <div class="review-form-wrapper">
        {% if request.user.is_authenticated %}
            {% include 'products/includes/product-review-form.html' %}
        {% else %}
            <p class="text-center">Please <a class="dropdown-item" href="{% url 'account_signup' %}">Register</a> or <a class="dropdown-item" href="{% url 'account_login' %}">Login</a> to leave a review.</p>
        {% endif %}
    </div>

    <div id="product-reviews" class="reviews-wrapper my-5">
        {% for review in product.reviews.all %}
            <div class="card">
                <div class="card-header">
                    <p class="text-center">{{ review.rating }}</p>
                    {% if review.verified_purchase %}<p class="text-center"><small>Verified purchase</small></p>{% endif %}
                </div>
                <div class="card-body">
                  <h5 class="card-title">{{ review.title }}</h5>
                  <p class="card-text">{{ review.body }}</p>
                </div>
                <div class="card-footer text-muted">
                    by {{ review.user.username }} on {{ review.created_on|date:"SHORT_DATE_FORMAT" }}
                </div>
              </div>
        {% empty %}
              <p class="text-center">No reviews yet!</p>
        {% endfor %}
    </div>

</div>

{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {% include 'products/includes/quantity_input_script.html' %}
{% endblock %}
